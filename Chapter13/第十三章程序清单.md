## 程序清单13.1 `count.c`程序

```c
#include <stdio.h>
#include <stdlib.h> //提供exit()的原型

int main(int argc, char const *argv[])
{
    int ch; /* 读取文件时，储存每个字符的地方 */
    FILE *fp;   /* 文件指针 */
    unsigned long count = 0;
    if (argc != 2)
    {
        printf("Usage:%s filename\n", argv[0]);
        exit(EXIT_FAILURE);
    }
    if ((fp = fopen(argv[1], "r")) == NULL)
    {
        printf("Can't open %s \n", argv[1]);
        exit(EXIT_FAILURE);
    }
    while ((ch = getc(fp)) != EOF)
    {
        putc(ch, stdout);
        count++;
    }
    fclose(fp);
    printf("File %s has %lu characters\n", argv[1], count);

    return 0;
}
```

### `int main(int argc, char const *argv[])`函数

`argc`是命令行总的参数个数。

`argv[]`是`argc`个参数，其中第0个参数是程序的全名，以后的参数是命令行后面跟的用户输入的参数。例如

```sh
E:\gitee\c_language\build> .\count.exe read
```

有两个命令行参数`argc=2`
`argv[0]`为`.\count.exe`即其绝对位置`E:\gitee\c_language\build\count.exe`

`argv[1]`为`read`

### `fopen()`函数

该函数声明在`stdio.h`中。

使用给定的模式`_Mode`打开`_Filename`所指向的文件。

**函数原型**

​	**FILE** ***fopen**(const char ***__restrict__** _Filename, const char ***__restrict__** _Mode)

**参数**

- `_Filename`：这是C字符串，包含了要打开的文件名称。
- `_Mode`：这是C字符串，包含了文件访问模式。

`fopen()`的模式字符串

| 模式字符串                                                   | 含义                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| "r"                                                          | 以读模式打开文件                                             |
| "w"                                                          | 以写模式打开文件，把现有的文件长度截为0，如果文件不存在，则创建一个文件。 |
| "a"                                                          | 以写模式打开文件，在现有文件末尾添加内容，如果文件不存在，则创建一个文件。 |
| "r+"                                                         | 以更新模式打开文件（即可以读写文件）                         |
| "w+"                                                         | 以更新模式打开文件（即可以读写文件）<br />如果文件存在，则将其长度截为0；<br />如果文件不存在，则创建一个新文件。 |
| "a+"                                                         | 以更新模式打开文件（即可以读写文件）<br />在现有文件的末尾添加内容；<br />如果文件不存在，则创建一个新文件；<br />可以读整个文件，但只能从末尾添加内容。 |
| "rb"、"wb"、"ab"、<br />"rb+"、"wb+"、"ab+"、<br />"r+b"、"w+b"、"a+b" | 与上一个模式类似，但是是以二进制模式而不是文本模式打开文件。 |
| "wx"、"w+x"、<br />"wbx"、"wb+x"、"w+bx"                     | （C11）类似非x模式，但是如果文件已存在或以独占模式打开文件，则打开文件失败。 |

- 像`UNIX`和`Linux`这样只有一种文件类型的系统，带`b`字母的模式和不带`b`字母的模式相同。
- 新的C11新增了带x字母的写模式，与以前的写模式相比具有更多特性。
  1. 如果以传统的一种写模式打开一个现有文件，fopen()会把该文件的长度截为0，这样就丢失了该文件的内容。但是使用带x字母的写模式，即使fopen()操作失败，原文件的内容也不会被删除。
  2. 如果环境允许，x模式的独占特性使得其他程序或线程无法访问正在被打开的文件。